<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=fetch,Promise,URLSearchParams,Element.prototype.closest,Array.prototype.find,Array.prototype.includes"></script>
  <title id="doc-title">Post • Crecientech</title>
  <link rel="canonical" id="canonical" href="https://www.crecientech.com/blog/post.html" />
  <meta name="description" id="meta-desc" content="Read insights from Crecientech on technology and product development."> 
  <meta property="og:title" id="og-title" content="Post • Crecientech">
  <meta property="og:description" id="og-desc" content="Read insights from Crecientech on technology and product development.">
  <meta property="og:url" id="og-url" content="">
  <meta property="og:image" content="https://www.crecientech.com/img/navbar/navbar_logo.png">
  <meta name="twitter:card" content="summary_large_image">
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://www.crecientech.com/blog/"},{"@type":"ListItem","position":2,"name":"Post","item":"https://www.crecientech.com/blog/post.html"}]}</script>

  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/css/style.css" />

  <style>
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    .meta{color:#6b7280;font-size:14px;margin-top:-8px}
    .content img{max-width:100%;border-radius:8px}
    .content pre{background:#0b1020;color:#e5e7eb;padding:12px;border-radius:8px;overflow:auto}
  </style>
</head>
<body>
  <div class="wrap">
    <a href="/blog/">&larr; All posts</a>
    <h1 id="title"></h1>
    <p class="meta"><span id="date"></span> • <span id="read"></span></p>
    <div id="content" class="content">Loading…</div>
  </div>

  <!-- markdown renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    function fmt(iso){ try { return new Date(iso+'T00:00:00').toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});} catch(e){return iso;} }

    async function loadMeta(slug){
      // read index.json to get date/minutes/excerpt for this slug
      try {
        const r = await fetch('http://localhost:3001/posts', { cache: 'no-store' });
        if (r.ok) {
          const list = await r.json();
          return list.find(p=>p.slug===slug) || null;
        }
      } catch(e){}
      const r2 = await fetch('index.json', { cache:'no-store' });
      if (r2.ok){
        const list = await r2.json();
        return list.find(p=>p.slug===slug) || null;
      }
      return null;
    }

    async function loadMarkdown(slug){
      // try local API (dev), else static md (prod)
      try {
        const r = await fetch(`http://localhost:3001/posts/${encodeURIComponent(slug)}`, { cache:'no-store' });
        if (r.ok) { const json = await r.json(); return json.body || ''; }
      } catch(e){}
      const r2 = await fetch(`posts/${slug}.md`, { cache:'no-store' });
      return r2.ok ? r2.text() : '# Not found';
    }

    async function render(){
      const params = new URLSearchParams(location.search);
      const slug = params.get('slug');
      if (!slug){ document.getElementById('content').textContent='Missing slug'; return; }

      const [meta, md] = await Promise.all([loadMeta(slug), loadMarkdown(slug)]);
      const title = meta?.title || slug;
      document.title = title + ' • Crecientech';
      document.getElementById('title').textContent = title;
      document.getElementById('date').textContent = meta?.date ? fmt(meta.date) : '';
      document.getElementById('read').textContent = (meta?.minutes||3) + ' min read';

      var canonicalHref = (location.origin + location.pathname + location.search);
      var desc = meta?.excerpt || ('Read "' + title + '" from Crecientech.');
      document.getElementById('canonical').setAttribute('href', canonicalHref);
      document.getElementById('meta-desc').setAttribute('content', desc);
      document.getElementById('og-title').setAttribute('content', title + ' • Crecientech');
      document.getElementById('og-desc').setAttribute('content', desc);
      document.getElementById('og-url').setAttribute('content', canonicalHref);
      var ld = {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": title,
        "author": meta?.author ? {"@type":"Person","name": meta.author} : undefined,
        "datePublished": meta?.date || undefined,
        "dateModified": meta?.date || undefined,
        "publisher": {"@type":"Organization","name":"Crecientech","logo":{"@type":"ImageObject","url":"https://www.crecientech.com/img/navbar/navbar_logo.png"}}
      };
      var s = document.createElement('script'); s.type = 'application/ld+json'; s.text = JSON.stringify(ld);
      document.head.appendChild(s);

      // render markdown → html
      const html = (window.marked && marked.parse) ? marked.parse(md) : md.replace(/\n/g,'<br/>');
      document.getElementById('content').innerHTML = html;
    }
    render();
  </script>
</body>
</html>
